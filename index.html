<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVYON Animated Transition to Form üéâ - Responsive</title>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>

    <style>
        /* ======================================================= */
        /* --- CSS VARIABLES & GLOBAL SETUP --- */
        /* ======================================================= */
        
        :root {
            /* Neon Colors */
            --neon-blue: #00FFFF; /* Primary Theme Color */
            --neon-pink: #FF00FF;
            --neon-purple: #8A2BE2;
            --neon-green: #39FF14;
            --neon-yellow: #FFFF00;
            /* Dark Background Gradient Colors */
            --dark-blue-1: #1a0349; 
            --dark-purple-2: #1A0A3A;
            --dark-red-3: #3A0A1A;
            --dark-cyan-4: #0A3A3A;
            --dark-magenta-5: #4a004e;
            --black-hole: #0a0a0a;
        }
        
        /* ----------------------------------------------------------------- */
        /* MOBILE-FIRST BODY STYLES (Default for all sizes) */
        /* ----------------------------------------------------------------- */
        body {
            /* Initial Background (Animated) */
            background: linear-gradient(
                -45deg, var(--dark-blue-1), var(--dark-purple-2), var(--dark-red-3), var(--dark-cyan-4), var(--dark-magenta-5)
            );
            background-size: 500% 500%; 
            animation: gradient-shift-bg 20s ease infinite; 
            
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            font-family: 'Poppins', sans-serif; /* Changed to Poppins for consistency */
            overflow-x: hidden; 
            overflow-y: hidden; /* Prevent body scroll during transition */
            position: relative;
        }
        
        @keyframes gradient-shift-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Utility class to hide pages */
        .hidden-content {
            display: none !important;
        }

        /* ======================================================= */
        /* --- PAGE 1: INTRO (AVYON) STYLES (RESPONSIVE) --- */
        /* ======================================================= */
        
        #page-1-content { 
            position: relative;
            z-index: 20; 
            /* Ensure it is responsive in its container */
            width: 100%; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #text-wrapper { 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Use a responsive fluid scale with clamp() for big text */
        #text-container-p1 {
            /* Mobile-first: 3rem minimum, 10vw for scaling, 8rem maximum */
            font-size: clamp(3rem, 15vw, 8rem); 
            font-weight: bold;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--neon-blue);
            text-shadow: 0 0 7px var(--neon-blue), 0 0 15px var(--neon-blue), 0 0 30px var(--neon-blue), 0 0 60px var(--neon-blue);
            transform-origin: center center; 
        }

        #text-container-p1 span {
            display: block;
            white-space: nowrap;
        }

        /* ======================================================= */
        /* --- PAGE 2: CYBER-PARTY STYLES (RESPONSIVE) --- */
        /* ======================================================= */

        .cyber-party-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Audiowide', cursive;
            background-color: transparent; 
        }

        #main-content-p2 { 
            z-index: 5;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            padding: 1rem; /* Add padding for mobile screens */
        }
        
        .tagline { color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); font-weight: bold; font-size: 1.25rem; } /* Mobile default */
        
        /* Neon AVYON 2K25 Text (NEON BLUE) - Responsive Scaling */
        .neon-heading {
            /* Mobile-first: 3rem minimum, 15vw for scaling, 8rem maximum */
            font-size: clamp(3rem, 15vw, 8rem);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--neon-blue);
            text-shadow: 0 0 7px var(--neon-blue), 0 0 15px var(--neon-blue), 0 0 30px var(--neon-blue);
            animation: subtle-shimmer 2s infinite alternate; 
            line-height: 1.1;
        }
        @keyframes subtle-shimmer { 0% { opacity: 0.9; } 100% { opacity: 1.0; } }

        /* Let's Go Button - Responsive Padding/Font */
        #go-button {
            padding: 0.8rem 2rem; 
            margin-top: 2rem; 
            /* Mobile-first font size with clamp() */
            font-size: clamp(1rem, 4vw, 1.25rem); 
            font-weight: bold; 
            color: white;
            background-color: transparent; 
            border: 3px solid; 
            cursor: pointer; 
            transition: all 0.3s ease-in-out;
            border-radius: 1.5rem;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.7), 0 0 20px rgba(138, 43, 226, 0.7);
            animation: pulse-glow 2s infinite alternate; 
            font-family: 'Audiowide', cursive;
        }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-pink); } 100% { box-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-blue); } }
        
        /* Floating Emojis P2 - Responsive Size */
        .floating-emoji-p2 {
            position: absolute; 
            font-size: clamp(1.5rem, 5vw, 3rem); /* Responsive size */
            pointer-events: none; 
            z-index: 4;
        }
        @keyframes float-bounce {
            0%, 100% { transform: translate(0, 0) rotate(0deg); } 
            25% { transform: translate(5vw, -10vh) rotate(5deg); } 
            50% { transform: translate(-5vw, 15vh) rotate(-5deg); } 
            75% { transform: translate(10vw, -5vh) rotate(10deg); }
        }
        
        /* Confetti Canvas */
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }

        /* ======================================================= */
        /* --- PAGE 3: FORM STYLES (RESPONSIVE) --- */
        /* ======================================================= */

       .form-page-body {
    /* Styles applied to the BODY on transition completion */
    background: url('/static/3.png'); /* Add your image path */
    background-size: cover; /* Gradient animation size, image cover */
    background-blend-mode: overlay; /* This blends gradient with image */
    background-position: center center;
    animation: gradient-animation-form 25s ease infinite;
    font-family: "Poppins", sans-serif;
    color: #ffffffaa;
    min-height: 100vh;
    width: 100%;
    display: grid; 
    place-items: center; 
    padding: 1rem; 
    overflow-y: auto;
    overflow-x: hidden;
    position: relative;
}


        @keyframes gradient-animation-form {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }
        
        #page-3-content-wrapper {
            width: 100%; 
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to the top when content is large */
            padding-top: 2rem; /* Add some top padding on larger screens */
            padding-bottom: 2rem; /* Add some bottom padding on larger screens */
        }
        
        /* Form Container Adjustments for Responsiveness */
        #form-container {
            /* Remove the fixed 700px width and use max-width for fluidity */
            width: 100%; /* Take full width of the wrapper on small screens */
            max-width: 700px; /* Max-width constraint for larger screens */
        }

        .neon-glow {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue); 
            color: #ffffff;
        }

        .input-glow:focus {
            outline: none; border-color: var(--neon-blue); box-shadow: 0 0 8px var(--neon-blue), 0 0 12px var(--neon-blue);
        }
        
        /* Button colors */
        .bg-gradient-to-r.from-pink-500.to-purple-600, .bg-gradient-to-r.from-cyan-400.to-purple-500 {
            background-image: linear-gradient(to right, var(--neon-blue), var(--neon-purple)) !important;
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.4);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Floating Emojis Form - Responsive Size/Opacity */
        .floating-emoji-form {
            position: absolute; 
            font-size: clamp(1.5rem, 4vw, 2rem); /* Responsive size */
            opacity: 1; 
            pointer-events: none;
            display: none; /* Hide on mobile by default to de-clutter */
        }

        /* Form Validation Styles */
        .error-message {
            color: #ff3860;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: block;
            text-shadow: 0 0 3px rgba(255, 56, 96, 0.7);
        }
        
        .input-error {
            border-color: #ff3860 !important;
            box-shadow: 0 0 5px rgba(255, 56, 96, 0.7) !important;
        }
        
        .input-success {
            border-color: var(--neon-green) !important;
            box-shadow: 0 0 5px rgba(57, 255, 20, 0.7) !important;
        }

        /* Excitement Rating Styles */
        .excitement-rating {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .rating-bar {
            flex: 1;
            height: 50px;
            margin: 0 2px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .rating-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #00FFFF, #FF00FF,#8A2BE2);
            opacity: 0.7;
            z-index: 0;
        }
        
        .rating-bar:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .rating-bar.active {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            transform: scale(1.1);
        }
        
        .rating-emoji {
            font-size: 1.5rem;
            z-index: 1;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            transition: all 0.3s ease;
        }
        
        .rating-bar.active .rating-emoji {
            transform: scale(1.3);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* MEDIA QUERY: Show floating emojis on larger screens */
        @media (min-width: 768px) {
            .floating-emoji-form {
                display: block;
            }
        }
        
        /* MEDIA QUERY: Adjust tagline text size on larger screens */
        @media (min-width: 768px) {
            .tagline {
                font-size: 1.5rem; 
            }
        }
    </style>
</head>
<body class="overflow-hidden">

    <!-- Audio Element -->
    <audio id="background-audio" loop>
        <source src="/static/dhaa.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div id="page-1-content">
        <div id="text-wrapper"> 
            <div id="text-container-p1">
                <span id="avyon-text">AVYON</span>
            </div>
        </div>
    </div>

    <div id="page-2-content" class="hidden-content">
        <canvas id="confetti-canvas"></canvas>
        <div id="main-content-p2">
            <h1 class="neon-heading">AVYON 2K25</h1>
            <p class="tagline">Party Mode: Activated üéä</p>
            <button id="go-button">Let's Go</button>
        </div>
        <div id="floating-elements-p2">
            <span class="floating-emoji-p2" style="top: 10%; left: 5%;">üéâ</span>
            <span class="floating-emoji-p2" style="top: 25%; right: 10%;">ü™©</span>
            <span class="floating-emoji-p2" style="bottom: 15%; left: 20%;">üòé</span>
            <span class="floating-emoji-p2" style="bottom: 5%; right: 25%;">üíÉ</span>
            <span class="floating-emoji-p2" style="top: 40%; left: 45%;">üï∫</span>
            <span class="floating-emoji-p2" style="top: 60%; right: 40%;">ü•≥</span>
        </div>
    </div>


    <div id="page-3-content" class="hidden-content w-full relative p-4" style="position: absolute; top: 100vh; left: 0;">
        <div id="page-3-content-wrapper" class="h-full w-full">
            <div class="floating-emoji-form top-10 left-1/4">üéà</div>
            <div class="floating-emoji-form bottom-5 right-1/4">üé∂</div>
            <div class="floating-emoji-form top-1/2 left-10">‚ú®</div>
            <div class="floating-emoji-form bottom-10 left-20">üé§</div>
            
            <div
                id="form-container"
                class="p-6 md:p-10 rounded-xl glass-card relative" 
            >
                <h1
                    id="form-title"
                    class="text-3xl md:text-5xl text-center mb-8 font-extrabold neon-glow"
                >
                    AVYON 2K25
                </h1>
        
                <div class="mb-8 h-1 bg-gray-700 rounded-full">
                    <div
                        id="progress-bar"
                        class="h-full bg-gradient-to-r from-purple-500 to-cyan-400 rounded-full w-0 transition-all duration-500 ease-out"
                    ></div>
                </div>
        
                <form id="freshers-form" class="space-y-6">
                    <div id="step-1" class="form-step">
                        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-cyan-400">
                            Step 1: Get to Know You üßë‚Äçüéì
                        </h2>
                        <div>
                            <label for="name" class="block mb-2 text-sm font-medium">1. Name</label>
                            <input type="text" id="name" placeholder="Enter your rockstar name üé∏" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300" required/>
                            <span class="error-message" id="name-error"></span>
                        </div>
                        <div>
                            <label for="rollno" class="block mb-2 text-sm font-medium">2. Roll No / Student ID</label>
                            <input type="text" id="rollno" placeholder="Your College ID" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300" required/>
                            <span class="error-message" id="rollno-error"></span>
                        </div>
                        <div>
                            <label for="hobby" class="block mb-2 text-sm font-medium">3. Hobby üïπÔ∏è</label>
                            <input type="text" id="hobby" placeholder="E.g., Binge-watching, Gaming, Power Napping" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300"/>
                            <span class="error-message" id="hobby-error"></span>
                        </div>
                        <button type="button" onclick="nextStep(2)" class="mt-8 w-full py-3 rounded-lg font-bold bg-gradient-to-r from-pink-500 to-purple-600 hover:opacity-90 transition duration-300 shadow-lg shadow-pink-500/50">
                            Next: Spill The Tea!
                        </button>
                    </div>
        
                    <div id="step-2" class="form-step hidden">
                        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-cyan-400">
                            Step 2: Spill The Tea ‚òï
                        </h2>
                        <div>
                            <label for="fantasy" class="block mb-2 text-sm font-medium">4. Your Wildest Fantasy üå†</label>
                            <textarea id="fantasy" rows="2" placeholder="Keep it fun! E.g., Becoming a food critic, traveling to space..." class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300"></textarea>
                            <span class="error-message" id="fantasy-error"></span>
                        </div>
                        <div>
                            <label for="guilty-pleasure" class="block mb-2 text-sm font-medium">5. Tell us your Guilty Pleasure ü§´</label>
                            <input type="text" id="guilty-pleasure" placeholder="E.g., Reality TV, Singing badly in the shower" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300"/>
                            <span class="error-message" id="guilty-pleasure-error"></span>
                        </div>
                        <div>
                            <label for="senior-date" class="block mb-2 text-sm font-medium">6. If you had to take one senior on a date, who would it be and why? ‚ù§Ô∏è‚Äçüî•</label>
                            <textarea id="senior-date" rows="2" placeholder="Be specific! Name and a funny reason, please." class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300"></textarea>
                            <span class="error-message" id="senior-date-error"></span>
                        </div>
                        <div class="flex justify-between gap-5 mt-8">
                            <button type="button" onclick="prevStep(1)" class="py-3 px-6 rounded-lg font-bold bg-gray-700 hover:bg-gray-600 transition duration-300">
                                Previous
                            </button>
                            <button type="button" onclick="nextStep(3)" class="py-3 px-6 rounded-lg font-bold bg-gradient-to-r from-pink-500 to-purple-600 hover:opacity-90 transition duration-300 shadow-lg shadow-pink-500/50">
                                Next: The Challenges
                            </button>
                        </div>
                    </div>
        
                    <div id="step-3" class="form-step hidden">
                        <h2 class="text-xl md:text-2xl font-semibold mb-4 text-cyan-400">
                            Step 3: The Challenges & Titles üèÜ
                        </h2>
                        <div class="mb-6">
                            <label for="secret" class="block mb-2 text-sm font-medium">7. A Secret About You üòà</label>
                            <p class="text-xs text-red-400 mb-2">
                                WARNING: We will reveal this secret on stage if you refuse to
                                perform any task!( VALID Secret )
                            </p>
                            <textarea id="secret" rows="2" placeholder="Type your biggest secret here..." class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 input-glow transition duration-300" required></textarea>
                            <span class="error-message" id="secret-error"></span>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block mb-3 text-sm font-medium">8. How excited are you for freshers? üéâ</label>
                            <div class="excitement-rating">
                                <div class="rating-bar" data-rating="1">
                                    <span class="rating-emoji">üò¢</span>
                                </div>
                                <div class="rating-bar" data-rating="2">
                                    <span class="rating-emoji">üòê</span>
                                </div>
                                <div class="rating-bar" data-rating="3">
                                    <span class="rating-emoji">üôÇ</span>
                                </div>
                                <div class="rating-bar" data-rating="4">
                                    <span class="rating-emoji">üòÑ</span>
                                </div>
                                <div class="rating-bar" data-rating="5">
                                    <span class="rating-emoji">ü§©</span>
                                </div>
                            </div>
                            <span class="error-message" id="excitement-error"></span>
                        </div>
        
                        <div class="mb-6">
                            <label class="block mb-3 text-sm font-medium">9. Which title are you interested in competing for?</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> 
                                <label class="flex items-center space-x-2 text-pink-400">
                                    <input type="checkbox" name="title" value="Mr.Fresher" class="form-checkbox h-5 w-5 text-pink-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Mr. Fresher</span>
                                </label>
                                <label class="flex items-center space-x-2 text-pink-400">
                                    <input type="checkbox" name="title" value="Ms.Fresher" class="form-checkbox h-5 w-5 text-pink-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Ms. Fresher</span>
                                </label>
                                <label class="flex items-center space-x-2 text-cyan-400">
                                    <input type="checkbox" name="title" value="Mr.Trendy" class="form-checkbox h-5 w-5 text-cyan-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Mr. Trendy</span>
                                </label>
                                <label class="flex items-center space-x-2 text-cyan-400">
                                    <input type="checkbox" name="title" value="Ms.Trendy" class="form-checkbox h-5 w-5 text-cyan-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Ms. Trendy</span>
                                </label>
                                <label class="flex items-center space-x-2 text-purple-400">
                                    <input type="checkbox" name="title" value="Mr.Entertainer" class="form-checkbox h-5 w-5 text-purple-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Mr. Entertainer</span>
                                </label>
                                <label class="flex items-center space-x-2 text-purple-400">
                                    <input type="checkbox" name="title" value="Ms.Entertainer" class="form-checkbox h-5 w-5 text-purple-600 bg-gray-800 border-gray-700 rounded"/>
                                    <span> Ms. Entertainer</span>
                                </label>
                            </div>
                            <span class="error-message" id="title-error"></span>
                        </div>
        
                        <div class="flex justify-between gap-5 mt-8">
                            <button type="button" onclick="prevStep(2)" class="py-3 px-6 rounded-lg font-bold bg-gray-700 hover:bg-gray-600 transition duration-300">
                                Previous
                            </button>
                            <button type="submit" id="submit-btn" class="py-3 px-6 rounded-lg font-bold bg-gradient-to-r from-cyan-400 to-purple-500 hover:from-cyan-500 hover:to-purple-700 transition duration-300 shadow-lg shadow-cyan-500/50">
                                Submit Response ü•≥
                            </button>
                        </div>
                    </div>
        
                    <div id="success-message" class="hidden text-center p-10">
                        <p class="text-3xl md:text-4xl neon-glow mb-4">
                            ü•≥ Thank You! Welcome to the Party! üé∂
                        </p>
                        <p class="text-base md:text-lg text-white">
                            Get ready for an unforgettable night!
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script>
        // --- Audio Setup ---
        const audio = document.getElementById('background-audio');
        
        // Set audio properties
        audio.volume = 0.5; // Set volume to 50%
        audio.loop = true; // Loop the audio
        
        // Function to play audio
        function playAudio() {
            audio.play().then(() => {
                console.log("Audio started playing");
            }).catch(error => {
                console.log("Audio play failed:", error);
            });
        }

        // --- Shared Elements ---
        const body = document.body;
        const page1Content = document.getElementById('page-1-content');
        const page2Content = document.getElementById('page-2-content');
        const page3Content = document.getElementById('page-3-content');
        const avyonTextSpan = document.getElementById('avyon-text'); 
        const textWrapperP1 = document.getElementById('text-wrapper'); 

        // --- PAGE 1: INTRO ANIMATION (AVYON) ---
        const typingDuration = 2.5; 
        
        // Initial GSAP setup: Start the text small, rotated, and far away (opacity 0)
        // Set the text wrapper to an off-screen starting point for the zoom-in
        gsap.set(textWrapperP1, { scale: 0.1, rotation: -30, opacity: 0 });

        const masterTimeline = gsap.timeline({
            // Increased duration for the entire sequence to make the entrance dramatic
            duration: 3.5, 
            defaults: { ease: "power2.inOut" },
            onComplete: showCyberPartyPage 
        });

        // 1. **DRAMATIC ZOOM-IN ENTRANCE** (Start: scale 0.1, rotation -30deg; End: scale 1, rotation 0deg)
        masterTimeline.to(textWrapperP1, { 
            opacity: 1, 
            scale: 1, // Zoom in to normal size
            rotation: 0, // Rotate to straight position
            duration: 1.5, 
            ease: "power3.out" // Use a strong "out" ease for a fast stop
        }, 0); // Start immediately at time 0

        // 2. **SUBTLE GLOW/SHIMMER EFFECT** (while waiting)
        masterTimeline.to(avyonTextSpan, {
            scale: 1.05,
            duration: 1.0,
            ease: "power1.inOut",
            yoyo: true, 
            repeat: 1, 
        }, ">-0.5"); // Starts at the end of the entrance, lasts 2.0s total

        // 3. **EXIT ANIMATION** (Zoom-out and rotate to Page 2)
        masterTimeline.to(textWrapperP1, { 
            opacity: 0, 
            scale: 20, 
            rotation: 15, // Smooth zoom-out and rotation for the exit
            duration: 1, 
            ease: "expo.in"
        }, ">-0.5"); // Overlap slightly

        // 4. Cleanup
        masterTimeline.set(page1Content, { 
            display: 'none',
        }, ">-0.2"); 


        // --- PAGE 2: CYBER-PARTY SCREEN SETUP ---
        function showCyberPartyPage() {
            page2Content.classList.add('cyber-party-page');
            page2Content.classList.remove('hidden-content');

            document.querySelectorAll('.floating-emoji-p2').forEach((el) => {
                const duration = 10 + Math.random() * 8; 
                const delay = Math.random() * 5; 
                el.style.animation = `float-bounce ${duration}s infinite alternate ease-in-out`;
                el.style.animationDelay = `${delay}s`;
            });

            const confettiCanvas = document.getElementById('confetti-canvas');
            const confettiSettings = {
                target: confettiCanvas, max: 300, size: 1.5, animate: true,
                props: ['circle', 'square', 'triangle', 'line'],
                colors: ['var(--neon-pink)', 'var(--neon-blue)', 'var(--neon-purple)', 'var(--neon-green)', 'var(--neon-yellow)'],
                clock: 25, start_from_pointer: false, respawn: false
            };
            const confetti = new ConfettiGenerator(confettiSettings);

            document.getElementById('go-button').addEventListener('click', () => {
                // Play audio when Let's Go button is clicked
                playAudio();
                
                confetti.render();
                gsap.to('#go-button', {
                    scale: 1.1, duration: 0.2, yoyo: true, repeat: 1,
                    boxShadow: '0 0 10px var(--neon-pink), 0 0 30px var(--neon-blue)',
                    onComplete: () => { setTimeout(() => { confetti.clear(); }, 3000); }
                });

                const transitionTimeline = gsap.timeline({
                    onStart: () => {
                        page3Content.classList.remove('hidden-content');
                        // Ensure body doesn't scroll while animating
                        body.classList.add('overflow-hidden'); 
                    },
                    onComplete: switchToFormPage 
                });

                transitionTimeline.to(page2Content, {
                    y: "-100vh", 
                    opacity: 0.5,
                    duration: 0.8,
                    ease: "power2.in"
                }, 0); 

                transitionTimeline.to(page3Content, {
                    y: "0", 
                    duration: 0.8,
                    ease: "power2.out"
                }, 0.2); 
                
                transitionTimeline.to(body, { 
                    onStart: () => {
                        // Clear the initial background animation before applying the new one
                        body.style.animation = 'none'; 
                    }
                }, 0.2); 
            });
        }

        // --- PAGE 3: FORM SCREEN TRANSITION (FINAL CENTERING) ---
        function switchToFormPage() {
            // 1. Hide the old page
            page2Content.classList.add('hidden-content');
            
            // 2. Apply form background styles (which includes the grid centering and overflow-y: auto)
            body.classList.remove('cyber-party-page', 'overflow-hidden');
            body.classList.add('form-page-body');
            
            // 3. FIX: Reliably remove all GSAP positioning and classes to allow the CSS Grid on the body to take over.
            gsap.set(page3Content, { clearProps: "all" });
            // Re-apply the necessary classes
            page3Content.classList.add('w-full', 'relative', 'p-4'); 

            // 4. Initialize form animations and logic
            initializeFormPage();
        }

        // --- PAGE 3: FORM SCRIPT LOGIC (Multi-Step Form) ---
        function initializeFormPage() {
            const formContainer = document.getElementById("form-container");
            const progressBar = document.getElementById("progress-bar");
            const formSteps = document.querySelectorAll(".form-step");
            const submitBtn = document.getElementById("submit-btn");
            let currentStep = 1;
            let excitementRating = 0;

            // Entrance Animation (Form Content) 
            gsap.fromTo(formContainer, { opacity: 0, scale: 0.98 }, { duration: 0.5, opacity: 1, scale: 1, ease: "power2.out", delay: 0.2 });

            // Floating Emojis Animation (Form) - Only for elements that are NOT display:none
            document.querySelectorAll(".floating-emoji-form").forEach((el, i) => {
                if(getComputedStyle(el).display !== 'none') {
                    gsap.to(el, {
                        y: "-=100", opacity: 0, duration: gsap.utils.random(8, 15), ease: "none", repeat: -1, yoyo: true, delay: i * 0.5,
                    });
                }
            });

            // Excitement Rating Selection
            document.querySelectorAll('.rating-bar').forEach(bar => {
                bar.addEventListener('click', function() {
                    // Remove active class from all bars
                    document.querySelectorAll('.rating-bar').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Add active class to clicked bar
                    this.classList.add('active');
                    
                    // Set the excitement rating value
                    excitementRating = parseInt(this.getAttribute('data-rating'));
                    
                    // Clear any error message
                    document.getElementById('excitement-error').textContent = '';
                });
            });

            // --- FORM VALIDATION FUNCTIONS ---
            function validateName() {
                const nameInput = document.getElementById('name');
                const nameError = document.getElementById('name-error');
                const nameValue = nameInput.value.trim();
                
                if (nameValue === '') {
                    nameError.textContent = 'Name is required';
                    nameInput.classList.add('input-error');
                    nameInput.classList.remove('input-success');
                    return false;
                } else if (nameValue.length < 5) {
                    nameError.textContent = 'Name must be at least 2 characters long';
                    nameInput.classList.add('input-error');
                    nameInput.classList.remove('input-success');
                    return false;
                } else if (!/^[a-zA-Z\s]+$/.test(nameValue)) {
                    nameError.textContent = 'Name can only contain letters and spaces';
                    nameInput.classList.add('input-error');
                    nameInput.classList.remove('input-success');
                    return false;
                } else {
                    nameError.textContent = '';
                    nameInput.classList.remove('input-error');
                    nameInput.classList.add('input-success');
                    return true;
                }
            }

            function validateRollNo() {
                const rollnoInput = document.getElementById('rollno');
                const rollnoError = document.getElementById('rollno-error');
                const rollnoValue = rollnoInput.value.trim();
                
                if (rollnoValue === '') {
                    rollnoError.textContent = 'Roll No / Student ID is required';
                    rollnoInput.classList.add('input-error');
                    rollnoInput.classList.remove('input-success');
                    return false;
                } else if (rollnoValue.length < 3) {
                    rollnoError.textContent = 'Roll No must be at least 3 characters long';
                    rollnoInput.classList.add('input-error');
                    rollnoInput.classList.remove('input-success');
                    return false;
                } else {
                    rollnoError.textContent = '';
                    rollnoInput.classList.remove('input-error');
                    rollnoInput.classList.add('input-success');
                    return true;
                }
            }

            function validateHobby() {
                const hobbyInput = document.getElementById('hobby');
                const hobbyError = document.getElementById('hobby-error');
                const hobbyValue = hobbyInput.value.trim();
                
                if (hobbyValue === '') {
                    hobbyError.textContent = 'Hobby is required';
                    hobbyInput.classList.add('input-error');
                    hobbyInput.classList.remove('input-success');
                    return false;
                } else if (hobbyValue.length < 3) {
                    hobbyError.textContent = 'Hobby must be at least 3 characters long';
                    hobbyInput.classList.add('input-error');
                    hobbyInput.classList.remove('input-success');
                    return false;
                } else {
                    hobbyError.textContent = '';
                    hobbyInput.classList.remove('input-error');
                    hobbyInput.classList.add('input-success');
                    return true;
                }
            }

            function validateFantasy() {
                const fantasyInput = document.getElementById('fantasy');
                const fantasyError = document.getElementById('fantasy-error');
                const fantasyValue = fantasyInput.value.trim();
                
                if (fantasyValue === '') {
                    fantasyError.textContent = 'Please share your wildest fantasy';
                    fantasyInput.classList.add('input-error');
                    fantasyInput.classList.remove('input-success');
                    return false;
                } else if (fantasyValue.length < 10) {
                    fantasyError.textContent = 'Please provide a more detailed answer (at least 10 characters)';
                    fantasyInput.classList.add('input-error');
                    fantasyInput.classList.remove('input-success');
                    return false;
                } else {
                    fantasyError.textContent = '';
                    fantasyInput.classList.remove('input-error');
                    fantasyInput.classList.add('input-success');
                    return true;
                }
            }

            // Removed validation for guilty pleasure
            function validateGuiltyPleasure() {
                // No validation needed for guilty pleasure
                return true;
            }

            function validateSeniorDate() {
                const seniorDateInput = document.getElementById('senior-date');
                const seniorDateError = document.getElementById('senior-date-error');
                const seniorDateValue = seniorDateInput.value.trim();
                
                if (seniorDateValue === '') {
                    seniorDateError.textContent = 'Please answer this question';
                    seniorDateInput.classList.add('input-error');
                    seniorDateInput.classList.remove('input-success');
                    return false;
                } else if (seniorDateValue.length < 15) {
                    seniorDateError.textContent = 'Please provide a more detailed answer (at least 15 characters)';
                    seniorDateInput.classList.add('input-error');
                    seniorDateInput.classList.remove('input-success');
                    return false;
                } else {
                    seniorDateError.textContent = '';
                    seniorDateInput.classList.remove('input-error');
                    seniorDateInput.classList.add('input-success');
                    return true;
                }
            }

            function validateSecret() {
                const secretInput = document.getElementById('secret');
                const secretError = document.getElementById('secret-error');
                const secretValue = secretInput.value.trim();
                
                if (secretValue === '') {
                    secretError.textContent = 'Please share a secret (required)';
                    secretInput.classList.add('input-error');
                    secretInput.classList.remove('input-success');
                    return false;
                } else if (secretValue.length < 10) {
                    secretError.textContent = 'Please provide a more detailed secret (at least 10 characters)';
                    secretInput.classList.add('input-error');
                    secretInput.classList.remove('input-success');
                    return false;
                } else {
                    secretError.textContent = '';
                    secretInput.classList.remove('input-error');
                    secretInput.classList.add('input-success');
                    return true;
                }
            }

            function validateExcitement() {
                const excitementError = document.getElementById('excitement-error');
                
                if (excitementRating === 0) {
                    excitementError.textContent = 'Please select your excitement level';
                    return false;
                } else {
                    excitementError.textContent = '';
                    return true;
                }
            }

            function validateTitle() {
                const titleCheckboxes = document.querySelectorAll('input[name="title"]:checked');
                const titleError = document.getElementById('title-error');
                
                if (titleCheckboxes.length === 0) {
                    titleError.textContent = 'Please select at least one title you are interested in';
                    return false;
                } else {
                    titleError.textContent = '';
                    return true;
                }
            }

            // Functions must be globally accessible for `onclick`
            window.updateProgress = function() {
                const progress = (currentStep / formSteps.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            window.validateCurrentStep = function() {
                let isValid = true;
                
                // Validate fields based on current step
                if (currentStep === 1) {
                    isValid = validateName() && validateRollNo() && validateHobby();
                } else if (currentStep === 2) {
                    isValid = validateFantasy() && validateGuiltyPleasure() && validateSeniorDate();
                } else if (currentStep === 3) {
                    isValid = validateSecret() && validateExcitement() && validateTitle();
                }
                
                return isValid;
            }

            window.nextStep = function(step) {
                if (!validateCurrentStep()) {
                    // Shake animation for invalid form
                    gsap.to(formSteps[currentStep - 1], {
                        x: 10,
                        duration: 0.1,
                        repeat: 5,
                        yoyo: true,
                        onComplete: () => {
                            gsap.set(formSteps[currentStep - 1], { x: 0 });
                        }
                    });
                    return;
                }
                
                gsap.to(formSteps[currentStep - 1], {
                    opacity: 0, x: -50, duration: 0.5,
                    onComplete: () => {
                        formSteps[currentStep - 1].classList.add("hidden");
                        currentStep = step;
                        updateProgress();
                        formSteps[currentStep - 1].classList.remove("hidden");
                        gsap.fromTo(formSteps[currentStep - 1], { opacity: 0, x: 50 }, { opacity: 1, x: 0, duration: 0.5 });
                    },
                });
            }

            window.prevStep = function(step) {
                gsap.to(formSteps[currentStep - 1], {
                    opacity: 0, x: 50, duration: 0.5,
                    onComplete: () => {
                        formSteps[currentStep - 1].classList.add("hidden");
                        currentStep = step;
                        updateProgress();
                        formSteps[currentStep - 1].classList.remove("hidden");
                        gsap.fromTo(formSteps[currentStep - 1], { opacity: 0, x: -50 }, { opacity: 1, x: 0, duration: 0.5 });
                    },
                });
            }

            // Add real-time validation
            document.getElementById('name').addEventListener('input', validateName);
            document.getElementById('rollno').addEventListener('input', validateRollNo);
            document.getElementById('hobby').addEventListener('input', validateHobby);
            document.getElementById('fantasy').addEventListener('input', validateFantasy);
            document.getElementById('senior-date').addEventListener('input', validateSeniorDate);
            document.getElementById('secret').addEventListener('input', validateSecret);
            
            // Add validation for title checkboxes
            const titleCheckboxes = document.querySelectorAll('input[name="title"]');
            titleCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', validateTitle);
            });

            // --- Form Submission Handler ---
            document
                .getElementById("freshers-form")
                .addEventListener("submit", function (e) {
                    e.preventDefault();

                    if (!validateCurrentStep()) {
                        // Shake animation for invalid form
                        gsap.to(formSteps[currentStep - 1], {
                            x: 10,
                            duration: 0.1,
                            repeat: 5,
                            yoyo: true,
                            onComplete: () => {
                                gsap.set(formSteps[currentStep - 1], { x: 0 });
                            }
                        });
                        alert("Please fill in all required fields correctly before submitting.");
                        return;
                    }

                    // Show loading state
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<span class="loading-spinner"></span> Submitting...';
                    submitBtn.disabled = true;

                    // Collect form data
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData.entries());
                    const titles = Array.from(e.target.querySelectorAll('input[name="title"]:checked')).map(cb => cb.value);
                    data.titles = titles;
                    data.excitementRating = excitementRating;
                    data.timestamp = new Date().toISOString();

                    // Send data to Flask backend
                    fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.status === 'success') {
                            // Show success message
                            gsap.to(formSteps[currentStep - 1], {
                                opacity: 0, duration: 0.5,
                                onComplete: () => {
                                    formSteps[currentStep - 1].classList.add("hidden");
                                    const successMessage = document.getElementById("success-message");
                                    successMessage.classList.remove("hidden");
                                    gsap.fromTo(successMessage, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.8, ease: "back.out(1.7)" });
                                },
                            });
                            console.log("Form Data Submitted:", data);
                        } else {
                            throw new Error(result.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('There was an error submitting your form. Please try again.');
                        // Reset button state
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    });
                });
            updateProgress();
        }
    </script>
</body>
</html>
